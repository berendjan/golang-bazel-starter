# Kind cluster configuration for local development
# This creates a minimal cluster without default CNI (kindnet) and kube-proxy
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
name: dev

# Configure containerd to use in-cluster registry via HTTP
containerdConfigPatches:
  - |-
    [plugins."io.containerd.grpc.v1.cri".registry.mirrors."registry.localhost"]
      endpoint = ["http://registry.localhost"]

networking:
  # Disable default CNI - allows you to install your own like cilium
  # disableDefaultCNI: true

  # Disable kube-proxy - useful for minimal setups or custom networking
  # kubeProxyMode: "none"

  # API server port on host
  apiServerPort: 6443

  # Pod subnet (if you install a CNI later)
  podSubnet: "10.244.0.0/16"

  # Service subnet
  serviceSubnet: "10.96.0.0/12"

nodes:
  # Single control-plane node for minimal setup
  - role: control-plane
    # Port mappings for accessing services from host
    extraPortMappings:
      # Map nginx ingress HTTP port
      - containerPort: 80
        hostPort: 80
        protocol: TCP
      # Map nginx ingress HTTPS port
      - containerPort: 443
        hostPort: 443
        protocol: TCP
      # Map container registry port
      - containerPort: 5000
        hostPort: 5001
        protocol: TCP
      # Map gRPC service port
      - containerPort: 25000
        hostPort: 25000
        protocol: TCP
      # Map HTTP gateway port
      - containerPort: 26000
        hostPort: 26000
        protocol: TCP

