# Interfaces specification
# Defines message routing for the configuration service

package: interfaces

# Go imports needed for the generated code
imports:
  - 'commonpb "github.com/berendjan/golang-bazel-starter/proto/common/v1"'
  - 'configpb "github.com/berendjan/golang-bazel-starter/proto/configuration/v1"'

# handlers
handlers:
  - name: accountRepository
    type: "configrepository.AccountDbRepository"
  - name: AccountApi
    type: "configapi.ConfigurationApi"
  - name: middlewareOne
    type: "middleone.MiddleOne"
  - name: middlewareTwo
    type: "middletwo.MiddleTwo"

# Routes define message flow keep in sync with `golang/generated/interfaces/interfaces.yaml`
routes:
  - source: AccountApi
    messages:

      - message: "*configpb.MiddleOneRequestProto"
        response: "(*configpb.AccountConfigurationProto, error)"
        receivers:
          - middlewareOne

      - message: "*configpb.AccountDeletionRequestProto"
        response: "(*commonpb.StatusResponseProto, error)"
        receivers:
          - middlewareTwo

      - message: "*configpb.ListAccountsRequestProto"
        response: "(*configpb.ListAccountsResponseProto, error)"
        receivers:
          - middlewareTwo

  - source: middlewareOne
    messages:

      - message: "*configpb.MiddleOneRequestProto"
        response: "(*configpb.AccountConfigurationProto, error)"
        receivers:
          - middlewareTwo
          - accountRepository

  - source: middlewareTwo
    messages:

      - message: "*configpb.AccountDeletionRequestProto"
        response: "(*commonpb.StatusResponseProto, error)"
        receivers:
          - accountRepository

      - message: "*configpb.ListAccountsRequestProto"
        response: "(*configpb.ListAccountsResponseProto, error)"
        receivers:
          - accountRepository
